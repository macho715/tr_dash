From c6abe630ddd68c08a955a9e2fd9c90c51c97de0c Mon Sep 17 00:00:00 2001
From: Cha <mscho715@gmail.com>
Date: Wed, 11 Feb 2026 22:59:56 +0400
Subject: [PATCH] backup: pre mobile ux implementation snapshot

---
 backups/pre_mobileux_head.txt                 |   1 +
 backups/pre_mobileux_status.txt               |   2 +
 .../mobile-ux-implementation-plan-20260211.md | 713 ++++++++++++++++++
 3 files changed, 716 insertions(+)
 create mode 100644 backups/pre_mobileux_head.txt
 create mode 100644 backups/pre_mobileux_status.txt
 create mode 100644 docs/plan/mobile-ux-implementation-plan-20260211.md

diff --git a/backups/pre_mobileux_head.txt b/backups/pre_mobileux_head.txt
new file mode 100644
index 00000000..02f9b261
--- /dev/null
+++ b/backups/pre_mobileux_head.txt
@@ -0,0 +1 @@
+4cd3cf54
diff --git a/backups/pre_mobileux_status.txt b/backups/pre_mobileux_status.txt
new file mode 100644
index 00000000..86c44187
--- /dev/null
+++ b/backups/pre_mobileux_status.txt
@@ -0,0 +1,2 @@
+?? backups/
+?? docs/plan/mobile-ux-implementation-plan-20260211.md
diff --git a/docs/plan/mobile-ux-implementation-plan-20260211.md b/docs/plan/mobile-ux-implementation-plan-20260211.md
new file mode 100644
index 00000000..6a2ac8e5
--- /dev/null
+++ b/docs/plan/mobile-ux-implementation-plan-20260211.md
@@ -0,0 +1,713 @@
+# TR Dashboard Mobile UX Implementation Plan
+
+**Contract**: v0.8.0  
+**Created**: 2026-02-11  
+**Status**: Ready for Implementation  
+**Based on**: innovation-scout-dashboard-upgrade-ideas-20260211.md §12
+
+---
+
+## Executive Summary
+
+This plan implements 14 mobile UX improvements (M1-M14) to maintain "Where → When/What → Evidence" 3-second readability and 2-click Why on mobile/tablet (≤768px). Focus: field operations with network instability, touch optimization, and minimal input.
+
+**Priority Tiers**:
+- **Quick Win** (1-2 weeks): M2, M4, M5, M9, M11, M12
+- **Short-term** (2-4 weeks): M1, M3, M7, M10
+- **Mid-term** (4-8 weeks): M6, M8, M13, M14
+
+---
+
+## Phase 1: Quick Win (1-2 weeks)
+
+### M2: Card 1 KPI · 1 Sparkline
+
+**Goal**: Mobile KPI cards show 1 core metric per card (e.g., "Next: Load-out 2/12 14:00"). Optional mini sparkline. Rest in tabs/drawer.
+
+**Tasks**:
+- [ ] Audit existing KPI cards (StoryHeader, VoyageCard, ActivityDetail)
+- [ ] Create `MobileKPICard` component: single metric + optional sparkline
+- [ ] Add `@media (max-width: 768px)` breakpoint rules
+- [ ] Hide secondary metrics on mobile, add "More" expansion
+- [ ] Update StoryHeader to use MobileKPICard on mobile
+
+**Files**:
+- `components/dashboard/StoryHeader.tsx` (modify)
+- `components/dashboard/MobileKPICard.tsx` (new)
+- `app/globals.css` (breakpoint utilities)
+
+**Acceptance**:
+- [ ] Mobile: 1 KPI per card, secondary in drawer/expansion
+- [ ] Desktop: unchanged multi-metric layout
+- [ ] Sparkline optional, max 60px height
+- [ ] SSOT: StoryHeader derives from `activity` state (no SSOT mutation)
+
+**Risk**: Layout shift if sparkline loads late → Solution: fixed skeleton height
+
+---
+
+### M4: Touch Target ≥44×44px
+
+**Goal**: All interactive elements (badges, buttons, tabs, collision items) ≥44×44 CSS px (WCAG 2.5.8+).
+
+**Tasks**:
+- [ ] Audit touch targets: badges, buttons, tabs, collision items, voyage cards
+- [ ] Update Tailwind config: `min-h-[44px] min-w-[44px]` utility
+- [ ] Add invisible hit area padding where visual size < 44px
+- [ ] Test on real device (iPhone SE, Android small phone)
+- [ ] Document touch target standard in `LAYOUT.md`
+
+**Files**:
+- `tailwind.config.ts` (utilities)
+- `components/shared/Badge.tsx` (modify)
+- `components/shared/Button.tsx` (modify)
+- `components/voyages/VoyageCard.tsx` (modify)
+- `components/schedule/CollisionItem.tsx` (modify)
+
+**Acceptance**:
+- [ ] All interactive elements ≥44×44px or have invisible hit area
+- [ ] No visual regression on desktop
+- [ ] Real device testing: no mis-taps in 10 user tests
+- [ ] Accessibility: screen reader labels for all targets
+
+**Risk**: Visual clutter if all elements grow → Solution: use invisible padding/margin
+
+---
+
+### M5: Typography & Contrast
+
+**Goal**: Mobile type scale (heading/body/caption), line-height, contrast ≥4.5:1. Efficient spacing.
+
+**Tasks**:
+- [ ] Define mobile type scale in Tailwind config
+  - Heading: text-lg (18px), leading-tight
+  - Body: text-sm (14px), leading-relaxed
+  - Caption: text-xs (12px), leading-normal
+- [ ] Audit contrast ratios (use Chrome DevTools or WebAIM checker)
+- [ ] Fix low-contrast text (ensure 4.5:1 for body, 3:1 for large text)
+- [ ] Apply mobile type scale at 768px breakpoint
+- [ ] Test in sunlight simulation (high brightness, glare)
+
+**Files**:
+- `tailwind.config.ts` (type scale, colors)
+- `app/globals.css` (mobile typography breakpoints)
+- `components/**/*.tsx` (apply mobile text utilities)
+
+**Acceptance**:
+- [ ] Contrast ≥4.5:1 for all body text (WebAIM checker)
+- [ ] Mobile type scale consistent across components
+- [ ] Readable in sunlight/low-light conditions
+- [ ] No oversized fonts (avoid 24px+ body text)
+
+**Risk**: Over-aggressive font size → Solution: test on real devices, prioritize clarity over size
+
+---
+
+### M9: Filter · Options in Drawer
+
+**Goal**: Trip/TR/Date/View mode selectors use drawer on mobile (≤768px). "Applied filters" chips visible in header.
+
+**Tasks**:
+- [ ] Create `FilterDrawer` component (bottom/side sheet)
+- [ ] Move Trip/TR/Date selectors into drawer on mobile
+- [ ] Add "Filters" button (44×44px) in global control bar
+- [ ] Show active filters as chips in header (e.g., "Trip 1", "Live Mode")
+- [ ] Drawer: slide-up animation, backdrop, close on apply/outside click
+- [ ] Desktop: keep existing dropdown layout
+
+**Files**:
+- `components/dashboard/FilterDrawer.tsx` (new)
+- `components/dashboard/GlobalControlBar.tsx` (modify: add drawer trigger)
+- `app/voyages/schedule/page.tsx` (integrate drawer)
+
+**Acceptance**:
+- [ ] Mobile: filters in drawer, chips in header
+- [ ] Desktop: unchanged dropdown layout
+- [ ] Drawer accessible (keyboard nav, screen reader, Escape to close)
+- [ ] Touch target for drawer trigger ≥44×44px
+- [ ] SSOT: filter state derives from URL params (no SSOT mutation)
+
+**Risk**: Drawer state sync with URL → Solution: use `useSearchParams` for canonical state
+
+---
+
+### M11: Minimal Text · Label Omission
+
+**Goal**: Hide verbose headers/legends on mobile. Show: card title, number, status badge. "More" to expand.
+
+**Tasks**:
+- [ ] Audit verbose text: legends, helper text, long labels
+- [ ] Add `@media (max-width: 768px) { display: none; }` for secondary text
+- [ ] Replace long labels with icons + tooltip/aria-label
+- [ ] Add "More" expansion for hidden details
+- [ ] Ensure core info (title, value, status) always visible
+
+**Files**:
+- `components/voyages/VoyageCard.tsx` (hide legend)
+- `components/schedule/GanttPanel.tsx` (hide y-axis labels if clutter)
+- `components/dashboard/StoryHeader.tsx` (minimal header text)
+
+**Acceptance**:
+- [ ] Mobile: 50% less text, core info visible, 3-second scan
+- [ ] Desktop: full text/labels
+- [ ] "More" expansion accessible
+- [ ] No information loss (details in expansion/tooltip)
+
+**Risk**: User confusion from hidden info → Solution: clear "More" affordance, icon meanings
+
+---
+
+### M12: 2-Click Why (Mobile)
+
+**Goal**: Collision badge touch → Why panel (full screen or bottom sheet). "1/2 → 2/2" step indicator. Large touch target.
+
+**Tasks**:
+- [ ] Audit existing 2-click Why flow (Badge → WhyPanel)
+- [ ] Mobile: WhyPanel as full-screen or bottom sheet (>50% height)
+- [ ] Add step indicator: "1/2" on badge, "2/2" in panel
+- [ ] Enlarge touch target for "Next" / "Evidence" links (≥44×44px)
+- [ ] Test on mobile: can user complete 2-click in <5s?
+- [ ] Desktop: unchanged side panel layout
+
+**Files**:
+- `components/collisions/CollisionBadge.tsx` (step indicator)
+- `components/collisions/WhyPanel.tsx` (mobile full-screen mode)
+- `app/voyages/schedule/page.tsx` (panel state)
+
+**Acceptance**:
+- [ ] Mobile: badge touch → full-screen/bottom sheet Why panel
+- [ ] Step indicator: "1/2 Why", "2/2 Evidence"
+- [ ] Touch targets ≥44×44px
+- [ ] Desktop: unchanged behavior
+- [ ] SSOT: panel derives from `collisions` state (read-only)
+
+**Risk**: Full-screen panel hides context → Solution: add "Back to Map" sticky header
+
+---
+
+## Phase 2: Short-Term (2-4 weeks)
+
+### M1: Mobile Story Header (1 Screen)
+
+**Goal**: ≤768px, StoryHeader fits one screen: Where (1 line) + When/What (next activity 1 line) + Evidence (unmet N count). Vertical stack, no scroll.
+
+**Tasks**:
+- [ ] Refactor StoryHeader to responsive layout
+- [ ] Mobile: vertical stack (Where | When/What | Evidence)
+- [ ] Truncate long text: "At Linkspan 3" → "LS3", tooltip for full
+- [ ] Evidence: show count only (e.g., "Evidence: 2 unmet")
+- [ ] Test on iPhone SE (375px width): fits without scroll?
+- [ ] Desktop: horizontal layout unchanged
+
+**Files**:
+- `components/dashboard/StoryHeader.tsx` (responsive layout)
+- `lib/utils/text-truncate.ts` (new: truncation utilities)
+
+**Acceptance**:
+- [ ] Mobile: fits 1 screen (≤600px height), no scroll for header
+- [ ] Where/When/What/Evidence all visible
+- [ ] Truncation preserves meaning, tooltip shows full text
+- [ ] Desktop: unchanged
+- [ ] 3-second readability test with 5 users
+
+**Risk**: Truncation loses context → Solution: smart abbreviations (Linkspan→LS, Load-out→LO), tooltips
+
+---
+
+### M3: Priority · Alert Top Pinned
+
+**Goal**: "Decide now" items (Immediate Actions N, At Risk Voyage, Evidence unmet) as top pinned banner/card. Color/icon for status.
+
+**Tasks**:
+- [ ] Create `PriorityBanner` component (sticky top)
+- [ ] Show: "Immediate Actions: 3", "At Risk: Voyage 2", "Evidence: 1 unmet"
+- [ ] Color code: red (critical), yellow (at risk), green (ok)
+- [ ] Icon: alert-circle, clock, check-circle
+- [ ] Click to jump to section (voyages/schedule/gantt, EvidencePanel)
+- [ ] Only show if items exist (hide if all OK)
+
+**Files**:
+- `components/dashboard/PriorityBanner.tsx` (new)
+- `app/voyages/schedule/page.tsx` (integrate at top)
+- `lib/data/priority-checks.ts` (new: derive priority from state)
+
+**Acceptance**:
+- [ ] Banner pinned at top on mobile
+- [ ] Shows 3 priority items max
+- [ ] Click navigates to relevant section
+- [ ] Hidden if no priority items
+- [ ] SSOT: derives from `activities`, `collisions`, `evidence` state
+
+**Risk**: Banner takes vertical space → Solution: collapsible after first view, "Dismiss" option
+
+---
+
+### M7: Vertical Stack + Tab/Drawer
+
+**Goal**: Mobile layout: Map | Detail | History/Evidence vertical stack. Gantt/Filter/Compare in tabs/drawer. Load core first.
+
+**Tasks**:
+- [ ] Refactor page layout for mobile: vertical stack
+- [ ] Order: PriorityBanner → Map → Detail → History/Evidence
+- [ ] Gantt → bottom drawer ("Timeline" button)
+- [ ] Compare → tab in Detail panel
+- [ ] Lazy load: Map/Detail immediate, Gantt/History on scroll/tab
+- [ ] Desktop: keep 3-column layout
+
+**Files**:
+- `app/voyages/schedule/page.tsx` (responsive layout)
+- `components/dashboard/MobileLayout.tsx` (new: vertical stack)
+- `components/schedule/GanttDrawer.tsx` (new: drawer for Gantt)
+
+**Acceptance**:
+- [ ] Mobile: vertical stack, Gantt in drawer
+- [ ] Desktop: 3-column unchanged
+- [ ] Lazy load: History/Evidence loads on scroll into view
+- [ ] One-handed scrolling (no horizontal scroll)
+- [ ] SSOT: layout doesn't mutate data, read-only display
+
+**Risk**: Drawer state management complexity → Solution: use URL hash for drawer state (#gantt, #compare)
+
+---
+
+### M10: Chart Simplification · Lazy Load
+
+**Goal**: Mobile Gantt/map: summary only (e.g., 1 bar per Voyage, map markers only). Detail on "View Detail" full screen. Render after filter apply.
+
+**Tasks**:
+- [ ] Mobile Gantt: 1 bar per Voyage (aggregate activities)
+- [ ] Mobile Map: markers only, no geofence polygons
+- [ ] "View Detail" button → full-screen detailed Gantt/Map
+- [ ] Lazy render: charts load after filter apply (skeleton first)
+- [ ] Desktop: full detail by default
+
+**Files**:
+- `components/schedule/GanttPanel.tsx` (mobile summary mode)
+- `components/map/MapPanel.tsx` (mobile marker-only mode)
+- `components/schedule/GanttDetailModal.tsx` (new: full-screen detail)
+
+**Acceptance**:
+- [ ] Mobile: simplified charts, <1s render
+- [ ] Desktop: full detail
+- [ ] "View Detail" accessible, ≥44×44px button
+- [ ] Skeleton loading state
+- [ ] SSOT: charts derive from `activities` state (read-only)
+
+**Risk**: Summary loses information → Solution: color-code Voyage bars by status (OK/At Risk/Late)
+
+---
+
+## Phase 3: Mid-Term (4-8 weeks)
+
+### M6: Glove · Low-Light Adaptation
+
+**Goal**: Field-ready (gloves, sunlight, dust): large buttons, icon+text, shape/pattern (not color only), screen reader labels.
+
+**Tasks**:
+- [ ] Audit buttons: add icon+text pairs (not text-only)
+- [ ] Status colors: add shape indicator (●=green, ▲=yellow, ■=red)
+- [ ] High contrast mode: test with Chrome DevTools emulation
+- [ ] Screen reader: all buttons have `aria-label`
+- [ ] Large primary actions: "Apply", "Go", "Evidence" ≥48×48px
+- [ ] Test with gloves (capacitive stylus or thick glove)
+
+**Files**:
+- `components/shared/Button.tsx` (icon+text variants)
+- `components/shared/StatusBadge.tsx` (shape indicators)
+- `app/globals.css` (high-contrast theme)
+
+**Acceptance**:
+- [ ] All primary actions have icon+text
+- [ ] Status uses shape+color (accessible for color-blind)
+- [ ] High contrast mode passes (4.5:1+)
+- [ ] Glove test: 90% tap success rate
+- [ ] Screen reader: all interactive elements labeled
+
+**Risk**: Icon meanings unclear → Solution: tooltip on hover/long-press, onboarding guide
+
+---
+
+### M8: Mobile-Specific View (Optional)
+
+**Goal**: Separate mobile view (duplicate components, rearrange). Focus: current location, next schedule, immediate actions. Gantt → simple list/timeline.
+
+**Tasks**:
+- [ ] Create `/app/voyages/schedule/mobile/page.tsx` route
+- [ ] Detect user agent or provide view toggle
+- [ ] Mobile view: Priority → Map → Next Activity → Immediate Actions
+- [ ] Gantt → simple list view (Activity name, time, status)
+- [ ] Share data fetching with desktop (same API)
+- [ ] Desktop: existing `/voyages/schedule/page.tsx` unchanged
+
+**Files**:
+- `app/voyages/schedule/mobile/page.tsx` (new)
+- `components/dashboard/MobileView.tsx` (new)
+- `components/schedule/SimpleTimeline.tsx` (new: list view)
+
+**Acceptance**:
+- [ ] Mobile view: faster load (<2s), focused content
+- [ ] Desktop view: unchanged
+- [ ] Shared data layer (no duplication)
+- [ ] User can toggle view (link in footer)
+- [ ] SSOT: both views derive from same `activities` state
+
+**Risk**: Maintenance burden (2 views) → Solution: deferred to mid-term, only if Quick Win insufficient
+
+---
+
+### M13: Offline Read Cache
+
+**Goal**: Cache recent SSOT/current Trip summary. Offline: "Cached data (HH:MM)" banner + read-only.
+
+**Tasks**:
+- [ ] Implement Service Worker with Cache API
+- [ ] Cache `/api/ssot` response (TTL: 1 hour)
+- [ ] Cache `option_c.json` (static data)
+- [ ] Offline: show banner "Cached data (12:34)"
+- [ ] Disable Apply/Preview in offline mode
+- [ ] Online: auto-refresh cache on focus/visibility change
+
+**Files**:
+- `public/sw.js` (new: Service Worker)
+- `app/layout.tsx` (register SW)
+- `lib/cache/offline-cache.ts` (new: cache logic)
+- `components/dashboard/OfflineBanner.tsx` (new)
+
+**Acceptance**:
+- [ ] Offline: app loads, shows cached data
+- [ ] Banner: "Cached data (HH:MM)", clear indicator
+- [ ] Read-only: Apply/Preview disabled
+- [ ] Online: auto-refresh, remove banner
+- [ ] SSOT: cache is snapshot, not canonical source
+
+**Risk**: Stale data confusion → Solution: large banner, relative time (e.g., "1 hour ago"), "Refresh" button
+
+---
+
+### M14: Push · Notification Summary
+
+**Goal**: Push notifications: "Immediate Actions: 1", "Voyage 2 At Risk". Tap → deep link to section.
+
+**Tasks**:
+- [ ] Request notification permission (Web Push API)
+- [ ] Server: send push on state change (Immediate Actions, At Risk Voyage)
+- [ ] Notification: title, body, action (deep link)
+- [ ] Client: handle notification click → navigate to section
+- [ ] Settings: allow/deny notifications
+- [ ] Test on iOS Safari, Android Chrome
+
+**Files**:
+- `public/sw.js` (push listener)
+- `lib/notifications/push.ts` (new: push logic)
+- `app/api/notifications/route.ts` (new: server endpoint)
+- `components/settings/NotificationSettings.tsx` (new)
+
+**Acceptance**:
+- [ ] Push notifications on state change
+- [ ] Deep link works (navigates to voyages/schedule#voyage-2)
+- [ ] User can disable in settings
+- [ ] iOS Safari, Android Chrome support
+- [ ] SSOT: notifications triggered by state changes (read-only)
+
+**Risk**: Browser permission denial → Solution: clear value prop ("Get alerts for delays"), fallback to in-app banners
+
+---
+
+## Component Impact Summary
+
+| Component | M2 | M4 | M5 | M9 | M11 | M12 | M1 | M3 | M7 | M10 | M6 | M8 | M13 | M14 |
+|-----------|----|----|----|----|-----|-----|----|----|----|----|----|----|-----|-----|
+| StoryHeader | ✓ | | ✓ | | ✓ | | ✓ | | | | | | | |
+| GlobalControlBar | | ✓ | | ✓ | | | | | | | | | | |
+| VoyageCard | | ✓ | ✓ | | ✓ | | | | | | | | | |
+| CollisionBadge | | ✓ | | | | ✓ | | | | | ✓ | | | |
+| WhyPanel | | | | | | ✓ | | | | | | | | |
+| MapPanel | | | | | | | | | ✓ | ✓ | | | | |
+| GanttPanel | | | | | ✓ | | | | ✓ | ✓ | | | | |
+| DetailPanel | | | ✓ | | | | | | ✓ | | | | | |
+| HistoryPanel | | | ✓ | | ✓ | | | | ✓ | | | | | |
+| EvidencePanel | | | ✓ | | ✓ | | | | ✓ | | | | | |
+| page.tsx | | | | | | | | ✓ | ✓ | | | ✓ | | |
+
+**New Components**:
+- M2: `MobileKPICard.tsx`
+- M3: `PriorityBanner.tsx`
+- M7: `MobileLayout.tsx`, `GanttDrawer.tsx`
+- M8: `MobileView.tsx`, `SimpleTimeline.tsx`
+- M9: `FilterDrawer.tsx`
+- M10: `GanttDetailModal.tsx`
+- M13: `OfflineBanner.tsx`
+- M14: `NotificationSettings.tsx`
+
+---
+
+## Responsive Strategy
+
+### Breakpoints
+
+```css
+/* tailwind.config.ts */
+screens: {
+  'mobile': {'max': '768px'},      // M1-M14 apply
+  'tablet': {'min': '769px', 'max': '1024px'}, // hybrid (test both)
+  'desktop': {'min': '1025px'}     // existing layout
+}
+```
+
+### Mobile-First CSS
+
+```css
+/* Default: mobile */
+.story-header { flex-direction: column; }
+
+/* Desktop: horizontal */
+@media (min-width: 1025px) {
+  .story-header { flex-direction: row; }
+}
+```
+
+### Progressive Enhancement
+
+1. **Core**: HTML + minimal CSS (works without JS)
+2. **Enhanced**: JS-powered interactions (drawer, filter, lazy load)
+3. **Offline**: Service Worker caching (M13)
+
+### Performance Budget
+
+- **Mobile**: First Contentful Paint <1.5s, Time to Interactive <3s
+- **Desktop**: FCP <1s, TTI <2s
+- **Bundle**: Mobile JS <150KB (gzip), Desktop JS <200KB
+
+---
+
+## Testing Strategy
+
+### Unit Tests
+
+```typescript
+// M4: Touch target size
+test('CollisionBadge has min 44x44px hit area', () => {
+  const { container } = render(<CollisionBadge />);
+  const badge = container.querySelector('[data-testid="collision-badge"]');
+  expect(badge).toHaveStyle({ minWidth: '44px', minHeight: '44px' });
+});
+
+// M5: Contrast ratio
+test('StoryHeader text has 4.5:1 contrast', () => {
+  const { getByText } = render(<StoryHeader />);
+  const text = getByText(/Where/);
+  const contrast = getContrastRatio(text);
+  expect(contrast).toBeGreaterThanOrEqual(4.5);
+});
+
+// M12: 2-click flow
+test('Collision badge click opens Why panel on mobile', async () => {
+  const { getByTestId, getByRole } = render(<SchedulePage />);
+  const badge = getByTestId('collision-badge-1');
+  await userEvent.click(badge);
+  expect(getByRole('dialog', { name: /Why Panel/ })).toBeInTheDocument();
+});
+```
+
+### Visual Regression
+
+- **Tool**: Playwright + Percy/Chromatic
+- **Breakpoints**: 375px (iPhone SE), 768px (tablet), 1440px (desktop)
+- **Scenarios**: Default, Priority Alert, Offline Banner, Drawer Open
+
+### Touch Interaction Tests
+
+```typescript
+// Real device testing (BrowserStack/LambdaTest)
+test('Priority banner tap navigates to section', async () => {
+  const { getByTestId } = render(<SchedulePage />);
+  const banner = getByTestId('priority-banner');
+  await userEvent.click(banner); // simulate touch
+  expect(window.location.hash).toBe('#voyages');
+});
+```
+
+### Accessibility Tests
+
+- **Automated**: axe-core in Playwright
+- **Manual**: iOS VoiceOver, Android TalkBack
+- **Keyboard**: Tab navigation, Escape to close drawer
+
+### Responsive Design Tests
+
+```typescript
+test('StoryHeader layout changes at 768px', () => {
+  const { container, rerender } = render(<StoryHeader />);
+  
+  // Desktop
+  Object.defineProperty(window, 'innerWidth', { value: 1440 });
+  expect(container.querySelector('.story-header')).toHaveClass('flex-row');
+  
+  // Mobile
+  Object.defineProperty(window, 'innerWidth', { value: 375 });
+  rerender(<StoryHeader />);
+  expect(container.querySelector('.story-header')).toHaveClass('flex-col');
+});
+```
+
+---
+
+## Risk Assessment
+
+| Risk | Severity | Mitigation |
+|------|----------|------------|
+| Touch targets too small (M4) | High | Audit with real devices, invisible padding |
+| Low contrast in sunlight (M5) | High | Test with Chrome DevTools emulation, 4.5:1+ |
+| Drawer state sync (M9) | Medium | Use URL hash as canonical state |
+| Offline cache stale (M13) | Medium | Large banner, relative time, manual refresh |
+| Notification permission denied (M14) | Low | Fallback to in-app banners |
+| Mobile-specific view maintenance (M8) | Medium | Defer to mid-term, evaluate Quick Win success first |
+| Layout shift on mobile (M1, M7) | Medium | Skeleton loading, fixed heights for dynamic content |
+
+---
+
+## Rollout Plan
+
+### Feature Flags
+
+```typescript
+// lib/feature-flags.ts
+export const MOBILE_UX_FLAGS = {
+  M2_MOBILE_KPI_CARD: true,
+  M4_TOUCH_TARGETS: true,
+  M5_TYPOGRAPHY: true,
+  M9_FILTER_DRAWER: true,
+  M11_MINIMAL_TEXT: true,
+  M12_2CLICK_MOBILE: true,
+  M1_STORY_HEADER_1SCREEN: false, // Phase 2
+  M3_PRIORITY_BANNER: false,
+  M7_VERTICAL_STACK: false,
+  M10_CHART_SIMPLIFY: false,
+  M6_GLOVE_LOWLIGHT: false, // Phase 3
+  M8_MOBILE_VIEW: false,
+  M13_OFFLINE_CACHE: false,
+  M14_PUSH_NOTIFICATIONS: false,
+};
+```
+
+### Preview Environment
+
+- **URL**: `https://tr-dashboard-preview.vercel.app?mobile=true`
+- **Devices**: iPhone SE, Pixel 5, iPad Mini, desktop
+- **Test Users**: 5 field operators, 3 planners
+
+### User Acceptance Criteria
+
+**Phase 1 (Quick Win)**:
+- [ ] 90% of touch targets ≥44×44px
+- [ ] Contrast ≥4.5:1 for all body text
+- [ ] Filter drawer usable with one hand
+- [ ] 2-click Why completes in <5s
+- [ ] User feedback: "easier on mobile" (4/5 rating)
+
+**Phase 2 (Short-term)**:
+- [ ] StoryHeader fits 1 screen (no scroll) on iPhone SE
+- [ ] Priority banner shows relevant items (no false alarms)
+- [ ] Vertical stack layout: <3s to scan Where/When/What
+- [ ] Gantt summary: 80% of info in simplified view
+
+**Phase 3 (Mid-term)**:
+- [ ] Offline mode: app loads, shows cached data
+- [ ] Glove test: 90% tap success rate
+- [ ] Push notifications: <5% permission denial rate
+
+### Rollback Plan
+
+- **Quick Win**: Feature flags off, revert to desktop layout
+- **Short-term**: Remove PriorityBanner, MobileLayout components
+- **Mid-term**: Unregister Service Worker, disable push
+
+---
+
+## SSOT Guardrails
+
+All mobile UX changes are **display-only**. No SSOT mutations.
+
+### Read-Only Display
+
+- **M1-M12, M14**: Derive from `activities`, `collisions`, `evidence` state
+- **M13**: Offline cache is snapshot (not canonical source)
+- **SSOT**: `option_c.json` via `/api/ssot` remains single source of truth
+
+### Preview → Apply Unchanged
+
+- Mobile UX does not affect Preview/Apply flow
+- Apply button remains in GlobalControlBar (desktop + mobile drawer)
+- Approval mode: Apply disabled regardless of device
+
+### Mode Separation
+
+- Mobile layout respects Live/History/Approval/Compare modes
+- History: read-only, no time travel on mobile (defer to desktop for now)
+- Approval: Export button accessible via drawer (M9)
+
+---
+
+## Acceptance Checklist
+
+### Phase 1: Quick Win
+
+- [ ] M2: Mobile KPI cards show 1 metric + optional sparkline
+- [ ] M4: All touch targets ≥44×44px (real device test)
+- [ ] M5: Typography contrast ≥4.5:1 (WebAIM checker)
+- [ ] M9: Filters in drawer, chips in header
+- [ ] M11: 50% less text on mobile, core info visible
+- [ ] M12: 2-click Why works (badge → full-screen panel)
+- [ ] Typecheck/lint: 0 errors
+- [ ] Build: successful
+- [ ] SSOT: no mutations, read-only display
+
+### Phase 2: Short-Term
+
+- [ ] M1: StoryHeader fits 1 screen (≤600px height)
+- [ ] M3: Priority banner shows top 3 items
+- [ ] M7: Vertical stack layout, Gantt in drawer
+- [ ] M10: Simplified charts, lazy load
+- [ ] Typecheck/lint: 0 errors
+- [ ] Build: successful
+- [ ] SSOT: no mutations
+
+### Phase 3: Mid-Term
+
+- [ ] M6: Glove/low-light ready (icon+text, shape+color)
+- [ ] M8: Mobile-specific view (optional, if needed)
+- [ ] M13: Offline cache works (banner, read-only)
+- [ ] M14: Push notifications (deep link)
+- [ ] Typecheck/lint: 0 errors
+- [ ] Build: successful
+- [ ] SSOT: notifications read-only, cache is snapshot
+
+---
+
+## Next Steps
+
+1. **Implement Phase 1 (Quick Win)** using tr-implementer
+   - Start with M4 (touch targets) and M5 (typography) for foundation
+   - Then M2, M9, M11, M12 in parallel
+
+2. **Real Device Testing** after Phase 1
+   - iPhone SE (375px), Pixel 5 (393px), iPad Mini (768px)
+   - Field test with 5 operators
+
+3. **Iterate Based on Feedback**
+   - If Quick Win insufficient → proceed to Phase 2
+   - If sufficient → defer Phase 3 (focus on other priorities)
+
+4. **Document in LAYOUT.md**
+   - Mobile breakpoints
+   - Touch target standards
+   - Typography scale
+   - Responsive layout rules
+
+---
+
+**References**:
+- `docs/innovation-scout-dashboard-upgrade-ideas-20260211.md` (§12)
+- `AGENTS.md` (Contract v0.8.0, SSOT rules)
+- `patch.md` (2-click Why, layout constraints)
+- `docs/LAYOUT.md` (existing responsive guidelines)
-- 
2.51.0.windows.1

